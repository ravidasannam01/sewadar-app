<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sewadar Management System</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Login Page -->
    <div id="login-page" class="page active">
        <div class="login-container">
            <div class="login-card">
                <div class="login-header">
                    <img src="/img.png" alt="Logo" class="login-logo" onerror="this.style.display='none'">
                    <h1>Sewadar Management</h1>
                    <h2>Login</h2>
                </div>
                <div id="login-error" class="error-message" style="display: none;"></div>
                <form id="login-form" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label>Zonal ID *</label>
                        <input type="text" id="login-zonalId" required autofocus>
                    </div>
                    <div class="form-group">
                        <label>Password *</label>
                        <input type="password" id="login-password" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block" id="login-btn">
                        Login
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="app-page" class="page">
        <header class="app-header">
            <h1>üèõÔ∏è Sewadar Management System</h1>
            <div class="user-info">
                <span id="user-name"></span>
                <span id="user-role" class="role-badge"></span>
                <button class="btn btn-secondary btn-sm" onclick="handleLogout()">Logout</button>
            </div>
        </header>

        <nav class="main-nav" id="main-nav">
            <!-- Navigation items will be populated by JavaScript based on role -->
        </nav>

        <main class="main-content">
            <!-- Programs Page -->
            <div id="programs-section" class="section active">
                <div class="section-header">
                    <h2>Programs</h2>
                    <button class="btn btn-primary" onclick="showProgramForm()" id="create-program-btn" style="display: none;">
                        + Create Program
                    </button>
                </div>
                <div class="filters">
                    <input type="text" id="program-search" placeholder="Search programs..." class="search-input">
                    <select id="program-status-filter" class="filter-select">
                        <option value="all">All Status</option>
                        <option value="scheduled">Scheduled</option>
                        <option value="active">Active</option>
                        <option value="completed">Completed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                </div>
                <div id="programs-list" class="list-container">
                    <p>Loading...</p>
                </div>
            </div>

            <!-- Applications Page - Removed: Functionality integrated into Programs page -->
            <!-- <div id="applications-section" class="section" style="display: none;">
                <div class="section-header">
                    <h2>My Applications</h2>
                </div>
                <div id="applications-list" class="list-container">
                    <p>Loading...</p>
                </div>
            </div> -->

            <!-- Admin Page -->
            <div id="admin-section" class="section">
                <div class="tabs">
                    <button class="tab-btn active" onclick="showAdminTab('programs')">Programs</button>
                    <button class="tab-btn" onclick="showAdminTab('sewadars')">Sewadars</button>
                </div>
                <div id="admin-programs-tab" class="tab-content active">
                    <div class="section-header">
                        <h2>Program Management</h2>
                        <button class="btn btn-primary" onclick="showProgramForm()">+ Create Program</button>
                    </div>
                    <div id="admin-programs-list" class="list-container">
                        <p>Loading...</p>
                    </div>
                </div>
                <div id="admin-sewadars-tab" class="tab-content">
                    <div class="section-header">
                        <h2>Sewadar Management</h2>
                        <button class="btn btn-primary" onclick="showSewadarForm()">+ Add Sewadar</button>
                    </div>
                    <div id="admin-sewadars-list" class="list-container">
                        <p>Loading...</p>
                    </div>
                </div>
            </div>

            <!-- Attendance Page -->
            <div id="attendance-section" class="section">
                <div class="section-header">
                    <h2>Attendance Management</h2>
                </div>
                <div id="attendance-programs-list" class="list-container">
                    <p>Loading...</p>
                </div>
            </div>

            <!-- Dashboard Page -->
            <div id="dashboard-section" class="section">
                <div class="tabs">
                    <button class="tab-btn active" onclick="showDashboardTab('sewadars')">Sewadars</button>
                    <button class="tab-btn" onclick="showDashboardTab('attendance')">Attendance Lookup</button>
                    <button class="tab-btn" onclick="showDashboardTab('forms')">Form Submissions</button>
                </div>
                <div id="dashboard-sewadars-tab" class="tab-content active">
                    <div class="section-header">
                        <h2>Sewadars Dashboard</h2>
                    </div>
                    <div class="filters">
                        <input type="text" id="dashboard-location-filter" placeholder="Location" class="filter-input">
                        <input type="text" id="dashboard-languages-filter" placeholder="Languages (comma-separated)" class="filter-input">
                        <button class="btn btn-primary" onclick="loadDashboardSewadars()">Apply Filters</button>
                        <button class="btn btn-secondary" onclick="clearDashboardFilters()">Clear</button>
                    </div>
                    <div id="dashboard-sewadars-list" class="list-container">
                        <p>Click "Apply Filters" to load sewadars</p>
                    </div>
                </div>
                <div id="dashboard-attendance-tab" class="tab-content">
                    <div class="section-header">
                        <h2>Attendance Lookup</h2>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div class="card">
                            <h3>Quick Lookup</h3>
                            <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Check if a sewadar is present on a specific date for a program</p>
                            <div class="filters">
                                <select id="attendance-lookup-program" class="filter-select" style="width: 100%; margin-bottom: 10px;">
                                    <option value="">Select Program</option>
                                </select>
                                <select id="attendance-lookup-sewadar" class="filter-select" style="width: 100%; margin-bottom: 10px;">
                                    <option value="">Select Sewadar</option>
                                </select>
                                <input type="date" id="attendance-lookup-date" class="filter-input" style="width: 100%; margin-bottom: 10px;">
                                <button class="btn btn-primary" onclick="handleQuickLookup()" style="width: 100%;">Check Attendance</button>
                            </div>
                            <div id="attendance-lookup-result" style="margin-top: 15px;"></div>
                        </div>
                        <div class="card">
                            <h3>Program Attendance</h3>
                            <p style="color: #666; font-size: 14px; margin-bottom: 15px;">View all attendance records for a specific program</p>
                            <div class="filters">
                                <select id="program-attendance-select" class="filter-select" style="width: 100%; margin-bottom: 10px;">
                                    <option value="">Select Program</option>
                                </select>
                                <button class="btn btn-primary" onclick="handleLoadProgramAttendance()" style="width: 100%;">Load Attendance</button>
                            </div>
                            <div id="program-attendance-list" style="margin-top: 15px;"></div>
                        </div>
                    </div>
                    <div class="card">
                        <h3>Multi-Program Attendance</h3>
                        <p style="color: #666; font-size: 14px; margin-bottom: 15px;">View attendance across multiple programs</p>
                        <div class="filters">
                            <select id="multi-program-select" multiple class="filter-select" style="width: 100%; margin-bottom: 10px; min-height: 100px;">
                            </select>
                            <button class="btn btn-primary" onclick="handleLoadMultiProgramAttendance()">Load Attendance</button>
                        </div>
                        <div id="multi-program-attendance-list" style="margin-top: 15px;"></div>
                    </div>
                </div>
                <div id="dashboard-forms-tab" class="tab-content">
                    <div class="section-header">
                        <h2>Form Submissions</h2>
                    </div>
                    <div class="filters">
                        <select id="forms-program-select" class="filter-select" style="width: 300px;">
                            <option value="">Select Program</option>
                        </select>
                        <button class="btn btn-primary" onclick="handleLoadFormSubmissions()">Load Forms</button>
                        <button class="btn btn-secondary" onclick="handleExportFormSubmissions()" id="export-forms-btn" disabled>Export CSV</button>
                    </div>
                    <div id="forms-list" class="list-container" style="margin-top: 20px;">
                        <p>Please select a program to view form submissions.</p>
                    </div>
                </div>
            </div>

            <!-- Workflow Page -->
            <div id="workflow-section" class="section">
                <div class="section-header">
                    <h2>Program Workflow Management</h2>
                </div>
                <div id="workflow-programs-list" class="list-container">
                    <p>Loading...</p>
                </div>
            </div>

            <!-- Pending Actions Page -->
            <div id="pending-actions-section" class="section">
                <div class="section-header">
                    <h2>Pending Actions</h2>
                </div>
                <div id="pending-actions-list" class="list-container">
                    <p>Loading...</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- Program Form Modal -->
    <div id="program-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeProgramForm()">&times;</span>
            <h3 id="program-form-title">Add Program</h3>
            <form id="program-form" onsubmit="saveProgram(event)">
                <input type="hidden" id="program-id">
                <div class="form-group">
                    <label>Title *</label>
                    <input type="text" id="program-title" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="program-description"></textarea>
                </div>
                <div class="form-group">
                    <label>Location *</label>
                    <input type="text" id="program-location" required>
                </div>
                <div class="form-group">
                    <label>Max Sewadars</label>
                    <input type="number" id="program-maxSewadars" min="1">
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="program-status">
                        <option value="active">Active</option>
                        <option value="scheduled">Scheduled</option>
                        <option value="completed">Completed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Program Dates (comma-separated, YYYY-MM-DD)</label>
                    <input type="text" id="program-dates" placeholder="2024-01-15, 2024-01-16">
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Save</button>
                    <button type="button" class="btn btn-secondary" onclick="closeProgramForm()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Sewadar Form Modal -->
    <div id="sewadar-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeSewadarForm()">&times;</span>
            <h3 id="sewadar-form-title">Add Sewadar</h3>
            <form id="sewadar-form" onsubmit="saveSewadar(event)">
                <input type="hidden" id="sewadar-zonalId">
                <div class="form-group">
                    <label>Zonal ID *</label>
                    <input type="text" id="sewadar-zonalId-input" required>
                    <small>Unique organizational identifier (provided by admin)</small>
                </div>
                <div class="form-group">
                    <label>First Name *</label>
                    <input type="text" id="sewadar-firstName" required>
                </div>
                <div class="form-group">
                    <label>Last Name *</label>
                    <input type="text" id="sewadar-lastName" required>
                </div>
                <div class="form-group">
                    <label>Location</label>
                    <input type="text" id="sewadar-location" placeholder="e.g., BEAS, Delhi, Mumbai">
                </div>
                <div class="form-group">
                    <label>Mobile</label>
                    <input type="text" id="sewadar-mobile">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="sewadar-password">
                    <small>Leave empty to use default password</small>
                </div>
                <div class="form-group">
                    <label>Profession</label>
                    <input type="text" id="sewadar-profession">
                </div>
                <div class="form-group">
                    <label>Aadhar Number</label>
                    <input type="text" id="sewadar-aadharNumber" maxlength="12">
                </div>
                <div class="form-group">
                    <label>Languages (comma-separated)</label>
                    <input type="text" id="sewadar-languages" placeholder="Hindi, English">
                </div>
                <div class="form-group">
                    <label>Address Line 1</label>
                    <input type="text" id="sewadar-address1">
                </div>
                <div class="form-group">
                    <label>Address Line 2</label>
                    <input type="text" id="sewadar-address2">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="sewadar-email">
                </div>
                <div class="form-group">
                    <label>Remarks</label>
                    <textarea id="sewadar-remarks"></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Save</button>
                    <button type="button" class="btn btn-secondary" onclick="closeSewadarForm()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Mark Attendance Modal -->
    <div id="attendance-modal" class="modal">
        <div class="modal-content large">
            <span class="close" onclick="closeAttendanceModal()">&times;</span>
            <h3 id="attendance-modal-title">Mark Attendance</h3>
            <div id="attendance-modal-content">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- View Attendance Modal - Removed: Replaced with CSV download -->
    <!-- <div id="view-attendance-modal" class="modal" style="display: none;">
        <div class="modal-content large">
            <span class="close" onclick="closeViewAttendanceModal()">&times;</span>
            <h3 id="view-attendance-modal-title">Attendance Records</h3>
            <div id="view-attendance-modal-content">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div> -->

    <!-- Applications Dialog Modal -->
    <div id="applications-dialog-modal" class="modal">
        <div class="modal-content large">
            <span class="close" onclick="closeApplicationsDialog()">&times;</span>
            <h3 id="applications-dialog-title">Applications</h3>
            <div id="applications-dialog-content">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Drop Requests Dialog Modal -->
    <div id="drop-requests-dialog-modal" class="modal">
        <div class="modal-content large">
            <span class="close" onclick="closeDropRequestsDialog()">&times;</span>
            <h3 id="drop-requests-dialog-title">Drop Requests</h3>
            <div id="drop-requests-dialog-content">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Password Change Modal -->
    <div id="password-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closePasswordModal()">&times;</span>
            <h3>Change Password</h3>
            <form onsubmit="savePassword(event)">
                <div class="form-group">
                    <label>New Password *</label>
                    <input type="password" id="new-password" required minlength="6">
                    <small>Password must be at least 6 characters long</small>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Change Password</button>
                    <button type="button" class="btn btn-secondary" onclick="closePasswordModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Role Change Modal -->
    <div id="role-change-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeRoleChangeModal()">&times;</span>
            <h3 id="role-change-title">Change Role</h3>
            <form onsubmit="saveRoleChange(event)">
                <div class="form-group">
                    <label>Your Password *</label>
                    <input type="password" id="role-change-password" required>
                    <small>Enter your password to confirm the role change</small>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary" id="role-change-btn">Confirm</button>
                    <button type="button" class="btn btn-secondary" onclick="closeRoleChangeModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Applicants List Modal -->
    <div id="applicants-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeApplicantsModal()">&times;</span>
            <h3 id="applicants-modal-title">Applicants</h3>
            <div id="applicants-modal-content">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Form Submission Modal (Pending Actions) -->
    <div id="form-submission-modal" class="modal">
        <div class="modal-content large">
            <span class="close" onclick="closeFormSubmissionModal()">&times;</span>
            <h3 id="form-submission-title">Travel Details Form</h3>
            <form id="form-submission-form" onsubmit="submitForm(event)">
                <!-- Name field removed - available from sewadar relationship -->
                <div class="form-group">
                    <label>Starting Date and time from Home</label>
                    <input type="datetime-local" id="form-starting-datetime">
                </div>
                <div class="form-group">
                    <label>Reaching Date and time to Home</label>
                    <input type="datetime-local" id="form-reaching-datetime">
                </div>
                <div class="form-group">
                    <label>Onward Train/Flight date and time</label>
                    <input type="datetime-local" id="form-onward-datetime">
                </div>
                <div class="form-group">
                    <label>Onward Train/Flight No.</label>
                    <input type="text" id="form-onward-number">
                </div>
                <div class="form-group">
                    <label>Return Train/Flight date and time</label>
                    <input type="datetime-local" id="form-return-datetime">
                </div>
                <div class="form-group">
                    <label>Return Train/Flight No.</label>
                    <input type="text" id="form-return-number">
                </div>
                <div class="form-group">
                    <label>In Hotel</label>
                    <textarea id="form-stay-hotel" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>In Pandal</label>
                    <textarea id="form-stay-pandal" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Submit</button>
                    <button type="button" class="btn btn-secondary" onclick="closeFormSubmissionModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="message" class="message"></div>

    <script src="app.js"></script>
</body>
</html>
